-- Adicionar ao banco_completo.txt - TABELA DE NOTIFICAÇÕES ATUALIZADA
-- =====================================================
-- TABELA: NOTIFICAÇÕES DO SISTEMA (VERSÃO COMPLETA)
-- =====================================================
CREATE TABLE IF NOT EXISTS `notificacoes` (
  `id` INT NOT NULL AUTO_INCREMENT,
  `id_usuario_destino` INT NOT NULL COMMENT 'ID do usuário que receberá a notificação',
  `id_usuario_criador` INT NULL DEFAULT NULL COMMENT 'ID do usuário que criou a notificação',
  `titulo` VARCHAR(200) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Título da notificação',
  `mensagem` TEXT CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'Mensagem da notificação',
  `tipo` ENUM('info','success','warning','danger') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'info' COMMENT 'Tipo visual da notificação',
  `categoria` ENUM('sistema','aula','materia','usuario','seguranca') CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL DEFAULT 'sistema' COMMENT 'Categoria da notificação',
  `lida` TINYINT(1) NOT NULL DEFAULT 0 COMMENT '0=Não lida, 1=Lida',
  `id_referencia` INT NULL DEFAULT NULL COMMENT 'ID do registro relacionado',
  `tabela_referencia` VARCHAR(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'Tabela do registro relacionado',
  `criada_em` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'Data de criação',
  `lida_em` DATETIME NULL DEFAULT NULL COMMENT 'Data quando foi lida',
  `expira_em` DATETIME NULL DEFAULT NULL COMMENT 'Data de expiração',
  PRIMARY KEY (`id`),
  INDEX `idx_usuario_destino` (`id_usuario_destino`),
  INDEX `idx_usuario_criador` (`id_usuario_criador`),
  INDEX `idx_lida` (`lida`),
  INDEX `idx_tipo` (`tipo`),
  INDEX `idx_categoria` (`categoria`),
  INDEX `idx_criada_em` (`criada_em`),
  INDEX `idx_referencia` (`id_referencia`, `tabela_referencia`),
  INDEX `idx_expira_em` (`expira_em`),
  FOREIGN KEY (`id_usuario_destino`) REFERENCES `usuarios`(`id`) ON DELETE CASCADE,
  FOREIGN KEY (`id_usuario_criador`) REFERENCES `usuarios`(`id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='Sistema completo de notificações com rastreamento de movimentações';

-- Inserir notificações de exemplo
INSERT INTO `notificacoes` (`id_usuario_destino`, `id_usuario_criador`, `titulo`, `mensagem`, `tipo`, `categoria`, `id_referencia`, `tabela_referencia`) VALUES
(1, NULL, 'Bem-vindo ao Sistema', 'Seja bem-vindo ao Sistema Acadêmico TCC! Explore todas as funcionalidades disponíveis.', 'success', 'sistema', NULL, NULL),
(1, 2, 'Nova Aula Cadastrada', 'Uma nova aula "Introdução à Mecatrônica" foi cadastrada', 'info', 'aula', 1, 'aulas'),
(2, 1, 'Matéria Atualizada', 'A matéria "Automação Industrial" foi atualizada', 'warning', 'materia', 1, 'materias'),
(1, NULL, 'Novo Professor', 'Um novo professor foi cadastrado no sistema', 'info', 'usuario', 3, 'cadastros_int');